(()=>{"use strict";var e,t,n,a,s,r,i,l;!function(e){e[e.INIT=0]="INIT",e[e.CHANGE_GARAGE_PAGE=1]="CHANGE_GARAGE_PAGE",e[e.CHANGE_WINNER_PAGE=2]="CHANGE_WINNER_PAGE",e[e.CREATE_CAR=3]="CREATE_CAR",e[e.UPDATE_CAR=4]="UPDATE_CAR"}(e||(e={})),function(e){e[e.DEFAULT=0]="DEFAULT",e[e.INIT=1]="INIT",e[e.GENERATE_100_CARS=2]="GENERATE_100_CARS",e[e.CHANGE_PAGE=3]="CHANGE_PAGE",e[e.CHANGE_WINNER_PAGE=4]="CHANGE_WINNER_PAGE",e[e.CREATE_CAR=5]="CREATE_CAR",e[e.UPDATE_CAR=6]="UPDATE_CAR",e[e.DELETE_CAR=7]="DELETE_CAR",e[e.SORT=8]="SORT",e[e.ADD_WINNER=9]="ADD_WINNER"}(t||(t={})),function(e){e.START="started",e.STOP="stopped",e.DRIVE="drive"}(n||(n={})),function(e){e.WINS_UP="wins-up",e.WINS_DOWN="wins-down",e.BESTTIME_UP="besttime-up",e.BESTTIME_DOWN="besttime-down"}(a||(a={})),function(e){e.WINS="wins",e.TIME="time"}(s||(s={})),function(e){e.ASC="ASC",e.DESC="DESC"}(r||(r={})),function(e){e[e.PREV=0]="PREV",e[e.NEXT=1]="NEXT"}(i||(i={})),function(e){e.NO_WINS_ERROR="All cars are broken :(",e.SOME_ERROR="Oops, some error has occurred"}(l||(l={}));const c=["Acura","Alfa Romeo","Alpine","Apollo","Apple","Aston Martin","Audi","Automobili Pininfarina","Bentley","BMW","Bollinger","Brilliance","Bugatti","Buick","BYD","Cadillac","Chana","Chery","Chevrolet","Chrysler","Citroen","Continental","CUPRA","Dacia","Daewoo","Daihatsu","Datsun","Detroit Electric","Dodge","DS Automobiles","FAW","Ferrari","Fiat","Fisker","Ford","Foxtron","Geely","Genesis","GMC","Great Wall","Haval","Honda","Hummer","Hyundai","Ineos","Infiniti","Iran Khodro","JAC","Jaguar","Jeep","JETOUR","KIA","Koenigsegg","Lada","Lamborghini","Lancia","Land Rover","Lexus","Lifan","Lincoln","Lordstown","Lotus","Lucid","LvChi","Lynk & Co","Maserati","Maybach","Mazda","MCLaren","Mercedes-Benz","MG","MINI","Mitsubishi","Nikola","NIO","Nissan","Opel","Pagani","Peugeot","Polestar","Porsche","Qoros","Range Rover","Ravon","Renault","Rimac","Rivian","Rolls-Royce","Saab","Saipa","SEAT","Skoda","smart","SsangYong","SSC North America","Stellantis","Subaru","Suzuki","Tata","Tesla","Torsus","Toyota","VinFast","Volkswagen","Volvo","Xpeng","Zotye"],o=["Durango","Ram","Challenger","Charger","Grand Caravan","X7","X5","X3","X6 M","X6","X1","X4","C3 Aircross","C5 Aircross","Duster","CR-V","Corolla","C4 Cactus","DS3 Crossback","C1","C3","Berlingo Multispace","DS4 Crossback","UX 250h","NX 300h","LC 500","RX 350/200t","Rapid","Largus","IS 200t","LS 500h","RX","ES 200/250/350","Hatchback","CX-5","Sedan","CX-30","CX-9","CX-3","MX-5 Roadster","Phantom","Camry","Polo","Cullinan","Ghost","Dawn","Duster","Arkana","Sandero","Logan","Trafic Fourgon","Logan MCV","Captur","Kadjar","RAV4","Rio","Creta","Solaris"],d=()=>`#${`${Math.random().toString(16)}ffffff`.slice(2,8)}`,h=()=>`${c[Math.floor(Math.random()*c.length)]} ${o[Math.floor(Math.random()*o.length)]}`,p=class{constructor(){this.element=null}getElement(){return this.element||(this.element=(e=>{const t=document.createElement("div");return t.innerHTML=e,t.firstElementChild})(this.getHTML())),this.element}removeElement(){this.element?.remove(),this.element=null}},u=async(e=1,t=7)=>{const n=await fetch(`https://async-race-be-mars.herokuapp.com/garage/?_page=${e}&_limit=${t}`);return{currentGarage:await n.json(),totalCars:+(n.headers.get("X-Total-Count")??"")}},g=async e=>fetch("https://async-race-be-mars.herokuapp.com/garage",{method:"POST",headers:new Headers({"Content-Type":"application/json"}),body:JSON.stringify(e)}),m=async(e=1,t="id",n="ASC")=>{const a=await fetch(`https://async-race-be-mars.herokuapp.com/winners/?_page=${e}&_limit=10&_sort=${t}&_order=${n}`);return{winners:await a.json(),totalWinners:+(a.headers.get("X-Total-Count")??0)}},E=async()=>{const e=await fetch("https://async-race-be-mars.herokuapp.com/winners");return await e.json()},y=async(e,t)=>fetch(`https://async-race-be-mars.herokuapp.com/engine/?id=${e}&status=${t}`,{method:"PATCH"}),C=new class{constructor(){this.observers=[],this.state={totalCars:0,totalWinners:0,garagePageNumber:1,currentGarage:[],winnersPageNumber:1,currentWinners:[],allWinners:[],sortby:"id",order:"ASC",lastWinner:{name:"",time:0}}}getData(){return this.state}addObserver(e){this.observers.push(e)}removeObserver(e){this.observers=this.observers.filter((t=>t!==e))}notify(e,t){this.observers.forEach((n=>n(e,t)))}dispatch(e){e instanceof Promise?e.then((e=>this.reducer(e))).catch((e=>console.log(`${l.SOME_ERROR}:\n${e}`))):this.reducer(e)}reducer(n){switch(n.type){case t.INIT:this.state={...this.state,...n.payload},this.notify(this.state,e.INIT);break;case t.GENERATE_100_CARS:case t.CHANGE_PAGE:this.state={...this.state,...n.payload},this.notify(this.state,e.CHANGE_GARAGE_PAGE);break;case t.CHANGE_WINNER_PAGE:this.state={...this.state,...n.payload},this.notify(this.state,e.CHANGE_WINNER_PAGE);break;case t.CREATE_CAR:this.state={...this.state,...n.payload},this.notify(this.state,e.CREATE_CAR);break;case t.UPDATE_CAR:case t.DELETE_CAR:this.state={...this.state,...n.payload},this.notify(this.state,e.UPDATE_CAR);break;case t.SORT:case t.ADD_WINNER:this.state={...this.state,...n.payload},this.notify(this.state,e.CHANGE_WINNER_PAGE)}}},b=async e=>{const t=e.map((async e=>(async e=>(await fetch(`https://async-race-be-mars.herokuapp.com/garage/${e}`)).json())(e.id)));return(await Promise.allSettled(t)).map((t=>"fulfilled"===t.status?{...e.find((e=>e.id===t.value.id)),...t.value}:null))},_=async e=>{let{garagePageNumber:n}=C.getData();const{totalCars:a}=C.getData(),s=Math.ceil(a/7);let r;return e===i.NEXT?(n=n>=s?n:n+=1,r=(await u(n)).currentGarage):e===i.PREV?(n=1===n?n:n-=1,r=(await u(n)).currentGarage):r=(await u(n)).currentGarage,{type:t.CHANGE_PAGE,payload:{garagePageNumber:n,currentGarage:r}}},w=async e=>{let{winnersPageNumber:n}=C.getData();const{totalWinners:a,sortby:s,order:r}=C.getData(),l=Math.ceil(a/10);let c;if(e===i.NEXT){n=n>=l?n:n+=1;const{winners:e}=await m(n,s,r);c=await b(e)}else if(e===i.PREV){n=1===n?n:n-=1;const{winners:e}=await m(n,s,r);c=await b(e)}else{const{winners:e}=await m(n,s,r);c=await b(e)}return{type:t.CHANGE_WINNER_PAGE,payload:{winnersPageNumber:n,currentWinners:c}}},v=async e=>{const{distance:t,velocity:a}=await(await y(e,n.START)).json(),s=t/a;return Math.ceil(s)},S=async e=>y(e,n.STOP),A=async e=>500!==(await y(e,n.DRIVE)).status,R=class extends p{constructor(e,t,n,a,s){super(),this.car=t,this.time=0,this.parentElement=e,this.selectClickHandler=n,this.deleteClickHandler=a,this.disableReset=s,this.handleSelectClick(),this.handleDeleteClick(),this.handleStartEngine(),this.handleStopEngine()}async startRace(){this.getElement().querySelector(".js-start").disabled=!0,this.disableControls(!0),this.time=await v(this.car.id)}async animateRace(){return this.carAnimation=this.setAnimation(this.time),this.carAnimation.play(),await A(this.car.id)?{id:this.car.id,time:this.time,name:this.car.name}:(this.carAnimation.pause(),Promise.reject())}async stopRace(){this.getElement().querySelector(".js-stop").disabled=!0,await S(this.car.id),this.carAnimation?.cancel(),this.getElement().querySelector(".js-start").disabled=!1}handleStartEngine(){this.getElement().querySelector(".js-start")?.addEventListener("click",(async e=>{e.currentTarget.disabled=!0,this.parentElement.querySelector(".js-race").disabled=!0;const t=await v(this.car.id);this.carAnimation=this.setAnimation(t),this.carAnimation.play(),this.parentElement.querySelector(".js-reset").disabled=!1,this.getElement().querySelector(".js-stop").disabled=!1,await A(this.car.id)||this.carAnimation.pause()}))}handleStopEngine(){this.getElement().querySelector(".js-stop")?.addEventListener("click",(async e=>{e.currentTarget.disabled=!0,await S(this.car.id),this.carAnimation?.cancel(),this.getElement().querySelector(".js-start").disabled=!1}))}handleSelectClick(){this.getElement().querySelector(".js-select")?.addEventListener("click",(()=>{this.selectClickHandler(this.car.id,this.car.name,this.car.color)}))}handleDeleteClick(){this.getElement().querySelector(".js-remove")?.addEventListener("click",(()=>{this.deleteClickHandler(this.car.id)}))}disableControls(e){this.getElement().querySelector(".js-remove").disabled=e,this.getElement().querySelector(".js-select").disabled=e}setAnimation(e){const t=this.getElement().querySelector(".track__car"),n=new KeyframeEffect(t,[{left:"0"},{left:"calc(100% - 50px)"}],{duration:e,fill:"forwards",easing:"ease-in-out"});return new Animation(n)}getHTML(){const{name:e,color:t}=this.car;return`\n      <div class="track">\n        <div class="track__controls">\n          <div class="track__top">\n            <button class="btn js-remove" type="button">üôÖ</button>\n            <button class="btn js-select" type="button">üëâ</button>\n          </div>\n          <div class="track__bottom">\n            <button class="btn js-start" type="button">A</button>\n            <button class="btn js-stop" type="button" disabled>B</button>\n          </div>\n        </div>\n        <div class="track__road">\n          <div class="track__name">${e}</div>\n          <div class="track__car">\n            <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\n            viewBox="0 0 512 512" style="enable-background:new 0 0 512 512;" xml:space="preserve">\n            <g>\n            <path style="fill:#FFFFFF;" d="M137.456,322.941c16.526,0,29.957,13.443,29.957,29.957c0,16.515-13.432,29.957-29.957,29.957\n            c-16.515,0-29.957-13.443-29.957-29.957C107.498,336.383,120.941,322.941,137.456,322.941z"/>\n            <path style="fill:#FFFFFF;" d="M374.544,322.941c16.515,0,29.957,13.443,29.957,29.957c0,16.515-13.443,29.957-29.957,29.957\n            c-16.526,0-29.957-13.443-29.957-29.957C344.587,336.383,358.019,322.941,374.544,322.941z"/>\n            <path style="fill:#FFFFFF;" d="M208.373,118.25v83.064H53.052l65.46-69.545c6.177-6.569,22.256-13.519,31.276-13.519H208.373z"/>\n            </g>\n            <path style="fill:#C5E2E2;" d="M335.665,129.056l33.596,72.257H208.373V118.25h110.265\n            C323.998,118.25,333.388,124.208,335.665,129.056z"/>\n            <path style="fill:${t};" d="M457.107,233.994c0-5.164,0.839-10.12,2.386-14.772c0-0.011-38.204-12.746-38.204-12.746\n            c-8.53-2.832-18.628-11.82-22.463-19.946l-33.596-71.397c-7.647-16.264-28.618-29.565-46.592-29.565H149.787\n            c-17.974,0-42.757,10.708-55.078,23.803l-75.34,80.046c-6.155,6.547-11.199,19.249-11.199,28.236v102.563\n            c0,17.974,14.706,32.681,32.681,32.681h23.073c0-40.611,32.921-73.532,73.532-73.532s73.532,32.921,73.532,73.532h90.025\n            c0-40.611,32.921-73.532,73.532-73.532s73.532,32.921,73.532,73.532c0,0,11.634,0,27.288,0s28.465-14.706,28.465-32.681v-39.5\n            C478.023,280.717,457.107,259.801,457.107,233.994z M53.052,201.314l65.46-69.545c6.177-6.569,22.256-13.519,31.276-13.519h168.851\n            c5.36,0,14.75,5.959,17.027,10.806l33.596,72.257H53.052z"/>\n            <g>\n            <path style="fill:#AECE71;" d="M137.456,279.366c40.611,0,73.532,32.921,73.532,73.532s-32.921,73.532-73.532,73.532\n            s-73.532-32.921-73.532-73.532S96.844,279.366,137.456,279.366z M167.413,352.898c0-16.515-13.432-29.957-29.957-29.957\n            c-16.515,0-29.957,13.443-29.957,29.957c0,16.515,13.443,29.957,29.957,29.957C153.981,382.856,167.413,369.413,167.413,352.898z"\n            />\n            <path style="fill:#AECE71;" d="M374.544,279.366c40.611,0,73.532,32.921,73.532,73.532s-32.921,73.532-73.532,73.532\n            s-73.532-32.921-73.532-73.532S333.933,279.366,374.544,279.366z M404.502,352.898c0-16.515-13.443-29.957-29.957-29.957\n            c-16.526,0-29.957,13.443-29.957,29.957c0,16.515,13.432,29.957,29.957,29.957C391.059,382.856,404.502,369.413,404.502,352.898z"\n            />\n            </g>\n            <path style="fill:#EEC278;" d="M459.504,219.223c24.38,8.127,44.326,35.796,44.326,61.494c-25.807,0-46.723-20.916-46.723-46.723\n            C457.107,228.831,457.946,223.874,459.504,219.223z"/>\n            <g>\n            <path style="fill:#700019;" d="M137.46,391.027c21.024,0,38.128-17.104,38.128-38.128c0-21.024-17.104-38.128-38.128-38.128\n            s-38.128,17.104-38.128,38.128C99.332,373.923,116.436,391.027,137.46,391.027z M137.46,331.112\n            c12.013,0,21.787,9.774,21.787,21.787s-9.774,21.787-21.787,21.787s-21.787-9.774-21.787-21.787S125.445,331.112,137.46,331.112z"\n            />\n            <path style="fill:#700019;" d="M374.54,314.772c-21.024,0-38.128,17.104-38.128,38.128c0,21.024,17.104,38.128,38.128,38.128\n            c21.024,0,38.128-17.104,38.128-38.128C412.668,331.876,395.564,314.772,374.54,314.772z M374.54,374.686\n            c-12.013,0-21.787-9.774-21.787-21.787s9.774-21.787,21.787-21.787s21.787,9.774,21.787,21.787S386.555,374.686,374.54,374.686z"/>\n            <path style="fill:#700019;" d="M149.787,126.419h25.904c4.513,0,8.17-3.658,8.17-8.17c0-4.512-3.657-8.17-8.17-8.17h-25.904\n            c-11.354,0-29.447,7.817-37.231,16.087l-65.458,69.55c-2.234,2.374-2.842,5.848-1.55,8.84c1.293,2.992,4.241,4.929,7.5,4.929\n            h316.21c2.791,0,5.387-1.424,6.888-3.777c1.5-2.352,1.697-5.308,0.521-7.838l-33.611-72.295\n            c-3.611-7.676-15.935-15.496-24.418-15.496H208.372c-4.513,0-8.17,3.658-8.17,8.17l-0.001,74.896H71.959l52.496-55.78\n            C129.077,132.454,143.046,126.419,149.787,126.419z M216.542,126.419h102.073c2.4,0.112,8.543,4.01,9.64,6.08l28.196,60.646\n            h-139.91L216.542,126.419z"/>\n            <path style="fill:#700019;" d="M512,280.719c0-29.011-22.392-60.077-49.913-69.251c-0.019-0.007-38.213-12.738-38.213-12.738\n            c-6.377-2.125-14.789-9.599-17.651-15.68l-33.596-71.391c-9.041-19.212-32.755-34.262-53.989-34.262H149.787\n            c-20.305,0-47.112,11.582-61.028,26.369l-75.338,80.048C5.895,191.811,0,206.674,0,217.655v102.563\n            c0,22.526,18.325,40.851,40.851,40.851h15.316c4.112,41.228,38.999,73.532,81.293,73.532s77.18-32.304,81.293-73.532h49.576\n            c4.513,0,8.17-3.658,8.17-8.17c0-4.512-3.657-8.17-8.17-8.17h-49.576c-4.112-41.228-38.999-73.532-81.293-73.532\n            s-77.18,32.304-81.293,73.532H40.851c-13.515,0-24.511-10.995-24.511-24.511V217.655c0-6.856,4.28-17.648,8.979-22.64l75.339-80.05\n            c10.829-11.507,33.328-21.227,49.129-21.227h168.851c14.905,0,32.857,11.393,39.203,24.879l33.596,71.391\n            c4.816,10.235,16.539,20.649,27.268,24.225l31.045,10.348c-0.536,3.095-0.815,6.241-0.815,9.414\n            c0,27.493,20.317,50.326,46.725,54.284v31.94c0,13.516-9.104,24.511-20.296,24.511h-19.531\n            c-4.112-41.228-38.999-73.532-81.293-73.532c-45.051,0-81.702,36.652-81.702,81.702s36.652,81.702,81.702,81.702\n            c42.293,0,77.18-32.304,81.293-73.532h19.531c20.201,0,36.636-18.325,36.636-40.851L512,280.719L512,280.719z M137.46,287.538\n            c36.04,0,65.362,29.321,65.362,65.362s-29.321,65.362-65.362,65.362s-65.362-29.321-65.362-65.362S101.42,287.538,137.46,287.538z\n            M374.54,418.261c-36.04,0-65.362-29.321-65.362-65.362s29.321-65.362,65.362-65.362s65.362,29.321,65.362,65.362\n            S410.58,418.261,374.54,418.261z M465.275,233.995c0-1.056,0.044-2.107,0.127-3.152c14.336,8.309,25.913,24.369,29.265,40.596\n            C477.819,267.317,465.275,252.097,465.275,233.995z"/>\n            </g>\n            </svg>\n          </div>\n\n          <div class="track__flag">\n            <span class="flag-svg">üèÅ</span>\n          </div>\n        </div>\n\n\n      </div>\n    `}},N=class extends p{constructor(){super(),this.selectedCar=null,this.tracksComponents=[],this.redraw=this.redraw.bind(this),C.addObserver(this.redraw),this.selectClickHandler=this.selectClickHandler.bind(this),this.deleteClickHandler=this.deleteClickHandler.bind(this),this.disableReset=this.disableReset.bind(this),this.generateElement(),this.handleGenerate100Cars(),this.handlePageChange(),this.handleCreateCar(),this.handleUpdateCar(),this.handleRace(),this.handleReset(),this.handleCloseModal()}redraw(t,n){n===e.CHANGE_GARAGE_PAGE?this.updatePage(t):n===e.CREATE_CAR?(this.resetCreateControl(),this.updatePage(t)):n===e.UPDATE_CAR&&(this.resetUpdateControl(),this.updatePage(t))}removeObserver(){C.removeObserver(this.redraw)}disableElements(e){this.getElement().querySelector(".js-create-name").disabled=e,this.getElement().querySelector(".js-create-color").disabled=e,this.getElement().querySelector(".js-create-car").disabled=e,this.getElement().querySelector(".js-prev").disabled=e,this.getElement().querySelector(".js-next").disabled=e,this.getElement().querySelector(".js-generate100cars").disabled=e}showWinnerModal(e,t){const n=this.getElement().querySelector(".js-garage-modal");n.querySelector(".js-garage-name").innerText=e,n.querySelector(".js-garage-time").innerText=0===t?"":`${t} s`,n.style.display="flex"}hideWinnerModal(){this.getElement().querySelector(".js-garage-modal").style.display="none"}disableReset(e){this.getElement().querySelector(".js-reset").disabled=e,this.getElement().querySelector(".js-race").disabled=!e}handleCloseModal(){this.getElement().querySelector(".js-modal-close").addEventListener("click",(()=>this.hideWinnerModal()))}handleRace(){this.getElement().querySelector(".js-race")?.addEventListener("click",(async e=>{e.currentTarget.disabled=!0,this.disableElements(!0);const n=this.tracksComponents.map((e=>e.startRace()));await Promise.allSettled(n);const a=this.tracksComponents.map((e=>e.animateRace()));try{const e=await Promise.any(a),n={...e,time:e.time/1e3};this.showWinnerModal(e.name,n.time),C.dispatch((async e=>{const{allWinners:n}=C.getData(),a=n.find((t=>t.id===e.id));if(void 0===a)await(async e=>fetch("https://async-race-be-mars.herokuapp.com/winners",{method:"POST",headers:new Headers({"Content-Type":"application/json"}),body:JSON.stringify(e)}))({...e,wins:1});else{if(!(a.time>e.time))return{type:t.DEFAULT};{const t={wins:a.wins+1,time:e.time};await(async(e,t)=>fetch(`https://async-race-be-mars.herokuapp.com/winners/${e}`,{method:"PUT",headers:new Headers({"Content-Type":"application/json"}),body:JSON.stringify(t)}))(e.id,t)}}const{winnersPageNumber:s,sortby:r,order:i}=C.getData(),{winners:l,totalWinners:c}=await m(s,r,i),o=await b(l),d=await E();return{type:t.ADD_WINNER,payload:{allWinners:d,currentWinners:o,totalWinners:c,lastWinner:{name:e.name,time:e.time}}}})(n))}catch(e){void 0!==e.message&&(console.log(l.NO_WINS_ERROR),this.showWinnerModal(l.NO_WINS_ERROR,0))}await Promise.allSettled(a),this.tracksComponents.forEach((e=>e.disableControls(!1))),this.disableElements(!1),this.getElement().querySelector(".js-reset").disabled=!1}))}handleReset(){this.getElement().querySelector(".js-reset")?.addEventListener("click",(async e=>{this.hideWinnerModal(),e.currentTarget.disabled=!0;const t=this.tracksComponents.map((e=>e.stopRace()));await Promise.allSettled(t),this.getElement().querySelector(".js-race").disabled=!1}))}handleCreateCar(){const e=this.getElement().querySelector(".controls__create"),n=e?.querySelector(".js-create-color"),a=e?.querySelector(".js-create-name");e?.querySelector(".js-create-car")?.addEventListener("click",(()=>{this.hideWinnerModal(),C.dispatch((async(e,n)=>{const a=""===e.trim()?h():e.trim();await g({name:a,color:n});const{garagePageNumber:s}=C.getData(),{currentGarage:r,totalCars:i}=await u(s);return{type:t.CREATE_CAR,payload:{totalCars:i,currentGarage:r}}})(a.value,n.value))}))}handleUpdateCar(){this.getElement().querySelector(".js-update-car")?.addEventListener("click",(()=>{if(null===this.selectedCar)return;let e=this.getElement().querySelector(".js-update-name").value;const n=this.getElement().querySelector(".js-update-color").value;e=""===e.trim()?this.selectedCar.name:e.trim(),C.dispatch((async(e,n)=>{await((e,t)=>fetch(`https://async-race-be-mars.herokuapp.com/garage/${e}`,{method:"PUT",headers:new Headers({"Content-Type":"application/json"}),body:JSON.stringify(t)}))(e,n);const{garagePageNumber:a,winnersPageNumber:s,sortby:r,order:i}=C.getData(),{currentGarage:l}=await u(a),{winners:c}=await m(s,r,i),o=await b(c);return{type:t.UPDATE_CAR,payload:{currentGarage:l,currentWinners:o}}})(this.selectedCar.id,{name:e,color:n}))}))}selectClickHandler(e,t,n){this.hideWinnerModal();const a=this.getElement().querySelector(".js-update-name"),s=this.getElement().querySelector(".js-update-color"),r=this.getElement().querySelector(".js-update-car");a.disabled=!1,a.value=t,s.disabled=!1,s.value=n,r.disabled=!1,this.selectedCar={id:e,name:t}}deleteClickHandler(e){this.hideWinnerModal(),C.dispatch((async e=>{await(e=>fetch(`https://async-race-be-mars.herokuapp.com/garage/${e}`,{method:"DELETE"}))(e),-1!==(await E()).findIndex((t=>t.id===e))&&await(e=>fetch(`https://async-race-be-mars.herokuapp.com/winners/${e}`,{method:"DELETE"}))(e);const{garagePageNumber:n,currentGarage:a,currentWinners:s,winnersPageNumber:r,sortby:i,order:l}=C.getData();let c,o;o=1===r||s.length>1?r:r-1;const{totalWinners:d,winners:h}=await m(o,i,l);c=1===n||a.length>1?n:n-1;const{currentGarage:p,totalCars:g}=await u(c);return{type:t.DELETE_CAR,payload:{currentGarage:p,totalCars:g,garagePageNumber:c,totalWinners:d,currentWinners:await b(h)}}})(e))}handleGenerate100Cars(){this.getElement().querySelector(".js-generate100cars")?.addEventListener("click",(()=>{this.hideWinnerModal(),C.dispatch((async()=>{await Promise.allSettled(Array(100).fill(0).map((()=>g({name:h(),color:d()}))));const{garagePageNumber:e}=C.getData(),{currentGarage:n,totalCars:a}=await u(e);return{type:t.GENERATE_100_CARS,payload:{totalCars:a,currentGarage:n}}})())}))}handlePageChange(){this.getElement().querySelector(".js-prev")?.addEventListener("click",(()=>{this.disableReset(!0),this.hideWinnerModal(),C.dispatch(_(i.PREV))})),this.getElement().querySelector(".js-next")?.addEventListener("click",(()=>{this.disableReset(!0),this.hideWinnerModal(),C.dispatch(_(i.NEXT))}))}resetCreateControl(){this.getElement().querySelector(".js-create-name").value="",this.getElement().querySelector(".js-create-color").value=d()}resetUpdateControl(){const e=this.getElement().querySelector(".js-update-name"),t=this.getElement().querySelector(".js-update-color"),n=this.getElement().querySelector(".js-update-car");this.selectedCar=null,e.value="",e.disabled=!0,t.value="#000000",t.disabled=!0,n.disabled=!0}updatePage(e){const{totalCars:t,currentGarage:n,garagePageNumber:a}=e;this.getElement().querySelector(".js-cars-amount").innerText=`${t}`;const s=this.getElement().querySelector(".js-tracks");s.innerHTML="",this.tracksComponents=n.map((e=>new R(this.getElement(),e,this.selectClickHandler,this.deleteClickHandler,this.disableReset)));const r=this.tracksComponents.map((e=>e.getElement()));s.append(...r),this.getElement().querySelector(".js-page-number").innerText=`${a}`}generateElement(){const{currentGarage:e}=C.getData(),t=this.getElement().querySelector(".js-tracks");this.tracksComponents=e.map((e=>new R(this.getElement(),e,this.selectClickHandler,this.deleteClickHandler,this.disableReset)));const n=this.tracksComponents.map((e=>e.getElement()));t.append(...n)}getHTML(){const{totalCars:e,garagePageNumber:t}=C.getData();return`\n    <div class="garage">\n      <div class="garage__modal js-garage-modal">\n        <span class="garage__close js-modal-close"></span>\n        <h3 class="garage__modal-title">Winner</h3>\n        <span class="garage__name js-garage-name"></span>\n        <span class="garage__time js-garage-time"></span>\n      </div>\n      <div class="controls">\n        <div class="controls__left">\n          <div class="controls__left-inner">\n            <div class="controls__create">\n              <div class="controls__create-inps">\n                <input class="inp js-create-name" type="text" />\n                <input class="color js-create-color" type="color" value="${d()}" />\n              </div>\n              <button class="btn js-create-car" type="button">create</button>\n            </div>\n            <div class="controls__update">\n              <div class="controls__create-inps">\n                <input class="inp js-update-name" type="text" disabled />\n                <input class="color js-update-color" type="color" disabled />\n              </div>\n              <button class="btn js-update-car" type="button" disabled>update</button>\n            </div>\n          </div>\n        </div>\n        <div class="controls__right">\n          <div class="controls__generate">\n            <button class="btn js-generate100cars" type="button">generate cars</button>\n          </div>\n          <div class="controls__race">\n            <button class="btn js-race" type="button">race</button>\n            <button class="btn js-reset" type="button" disabled>reset</button>\n          </div>\n        </div>\n      </div>\n      <h2 class="garage__title">Garage (<span class="js-cars-amount">${e}</span>)</h2>\n      <span class="garage__caption">Page ‚Ññ<span class="js-page-number">${t}</span></span>\n      <div class="garage__tracks js-tracks">\n      </div>\n      <div class="garage__pages">\n        <button class="btn js-prev" type="button">Prev</button>\n        <button class="btn js-next" type="button">Next</button>\n      </div>\n    </div>\n    `}},T=class extends p{constructor(){super(),this.handleSort()}handleSort(){this.getElement().querySelectorAll("[data-sort]").forEach((e=>{e.addEventListener("click",(e=>{C.dispatch((async e=>{if(void 0===e)return{type:t.DEFAULT};let n,i;e===a.WINS_UP?(n=s.WINS,i=r.ASC):e===a.WINS_DOWN?(n=s.WINS,i=r.DESC):e===a.BESTTIME_UP?(n=s.TIME,i=r.ASC):e===a.BESTTIME_DOWN&&(n=s.TIME,i=r.DESC);const{winnersPageNumber:l}=C.getData(),{winners:c}=await m(l,n,i),o=await b(c);return{type:t.SORT,payload:{currentWinners:o,sortby:n,order:i}}})(e.currentTarget.dataset.sort))}))}))}getHTML(){const{sortby:e,order:t}=C.getData();return`\n  <div class="winnersCaption row">\n  <span class="row__col-num">‚Ññ</span>\n  <span class="row__col-pic">Pic</span>\n  <span class="row__col-name">Name</span>\n  <span class="winnersCaption__wins row__col-wins">Wins\n    <span class="winners__sort ${e===s.WINS&&t===r.ASC?"active":""}" \n    data-sort="${a.WINS_UP}">‚òùÔ∏é</span>\n    <span class="winners__sort ${e===s.WINS&&t===r.DESC?"active":""}" \n    data-sort="${a.WINS_DOWN}">‚òü</span>\n  </span>\n  <span class="winnersCaption__time row__col-time">Best time\n    <span class="winners__sort ${e===s.TIME&&t===r.ASC?"active":""}" \n      data-sort="${a.BESTTIME_UP}">‚òùÔ∏é</span>\n    <span class="winners__sort ${e===s.TIME&&t===r.DESC?"active":""}" \n      data-sort="${a.BESTTIME_DOWN}">‚òü</span>\n  </span>\n  </div>`}},M=class extends p{constructor(e,t){super(),this.winner=e,this.number=t}getHTML(){const{wins:e,time:t,name:n,color:a}=this.winner;return`\n    <li class="winnerCar row">\n      <span class="winnerCar__num row__col-num">${this.number}</span>\n      <span class="winnerCar__pic row__col-pic">\n      <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\n      viewBox="0 0 512 512" style="enable-background:new 0 0 512 512;" xml:space="preserve">\n      <g>\n      <path style="fill:#FFFFFF;" d="M137.456,322.941c16.526,0,29.957,13.443,29.957,29.957c0,16.515-13.432,29.957-29.957,29.957\n      c-16.515,0-29.957-13.443-29.957-29.957C107.498,336.383,120.941,322.941,137.456,322.941z"/>\n      <path style="fill:#FFFFFF;" d="M374.544,322.941c16.515,0,29.957,13.443,29.957,29.957c0,16.515-13.443,29.957-29.957,29.957\n      c-16.526,0-29.957-13.443-29.957-29.957C344.587,336.383,358.019,322.941,374.544,322.941z"/>\n      <path style="fill:#FFFFFF;" d="M208.373,118.25v83.064H53.052l65.46-69.545c6.177-6.569,22.256-13.519,31.276-13.519H208.373z"/>\n      </g>\n      <path style="fill:#C5E2E2;" d="M335.665,129.056l33.596,72.257H208.373V118.25h110.265\n      C323.998,118.25,333.388,124.208,335.665,129.056z"/>\n      <path style="fill:${a};" d="M457.107,233.994c0-5.164,0.839-10.12,2.386-14.772c0-0.011-38.204-12.746-38.204-12.746\n      c-8.53-2.832-18.628-11.82-22.463-19.946l-33.596-71.397c-7.647-16.264-28.618-29.565-46.592-29.565H149.787\n      c-17.974,0-42.757,10.708-55.078,23.803l-75.34,80.046c-6.155,6.547-11.199,19.249-11.199,28.236v102.563\n      c0,17.974,14.706,32.681,32.681,32.681h23.073c0-40.611,32.921-73.532,73.532-73.532s73.532,32.921,73.532,73.532h90.025\n      c0-40.611,32.921-73.532,73.532-73.532s73.532,32.921,73.532,73.532c0,0,11.634,0,27.288,0s28.465-14.706,28.465-32.681v-39.5\n      C478.023,280.717,457.107,259.801,457.107,233.994z M53.052,201.314l65.46-69.545c6.177-6.569,22.256-13.519,31.276-13.519h168.851\n      c5.36,0,14.75,5.959,17.027,10.806l33.596,72.257H53.052z"/>\n      <g>\n      <path style="fill:#AECE71;" d="M137.456,279.366c40.611,0,73.532,32.921,73.532,73.532s-32.921,73.532-73.532,73.532\n      s-73.532-32.921-73.532-73.532S96.844,279.366,137.456,279.366z M167.413,352.898c0-16.515-13.432-29.957-29.957-29.957\n      c-16.515,0-29.957,13.443-29.957,29.957c0,16.515,13.443,29.957,29.957,29.957C153.981,382.856,167.413,369.413,167.413,352.898z"\n      />\n      <path style="fill:#AECE71;" d="M374.544,279.366c40.611,0,73.532,32.921,73.532,73.532s-32.921,73.532-73.532,73.532\n      s-73.532-32.921-73.532-73.532S333.933,279.366,374.544,279.366z M404.502,352.898c0-16.515-13.443-29.957-29.957-29.957\n      c-16.526,0-29.957,13.443-29.957,29.957c0,16.515,13.432,29.957,29.957,29.957C391.059,382.856,404.502,369.413,404.502,352.898z"\n      />\n      </g>\n      <path style="fill:#EEC278;" d="M459.504,219.223c24.38,8.127,44.326,35.796,44.326,61.494c-25.807,0-46.723-20.916-46.723-46.723\n      C457.107,228.831,457.946,223.874,459.504,219.223z"/>\n      <g>\n      <path style="fill:#700019;" d="M137.46,391.027c21.024,0,38.128-17.104,38.128-38.128c0-21.024-17.104-38.128-38.128-38.128\n      s-38.128,17.104-38.128,38.128C99.332,373.923,116.436,391.027,137.46,391.027z M137.46,331.112\n      c12.013,0,21.787,9.774,21.787,21.787s-9.774,21.787-21.787,21.787s-21.787-9.774-21.787-21.787S125.445,331.112,137.46,331.112z"\n      />\n      <path style="fill:#700019;" d="M374.54,314.772c-21.024,0-38.128,17.104-38.128,38.128c0,21.024,17.104,38.128,38.128,38.128\n      c21.024,0,38.128-17.104,38.128-38.128C412.668,331.876,395.564,314.772,374.54,314.772z M374.54,374.686\n      c-12.013,0-21.787-9.774-21.787-21.787s9.774-21.787,21.787-21.787s21.787,9.774,21.787,21.787S386.555,374.686,374.54,374.686z"/>\n      <path style="fill:#700019;" d="M149.787,126.419h25.904c4.513,0,8.17-3.658,8.17-8.17c0-4.512-3.657-8.17-8.17-8.17h-25.904\n      c-11.354,0-29.447,7.817-37.231,16.087l-65.458,69.55c-2.234,2.374-2.842,5.848-1.55,8.84c1.293,2.992,4.241,4.929,7.5,4.929\n      h316.21c2.791,0,5.387-1.424,6.888-3.777c1.5-2.352,1.697-5.308,0.521-7.838l-33.611-72.295\n      c-3.611-7.676-15.935-15.496-24.418-15.496H208.372c-4.513,0-8.17,3.658-8.17,8.17l-0.001,74.896H71.959l52.496-55.78\n      C129.077,132.454,143.046,126.419,149.787,126.419z M216.542,126.419h102.073c2.4,0.112,8.543,4.01,9.64,6.08l28.196,60.646\n      h-139.91L216.542,126.419z"/>\n      <path style="fill:#700019;" d="M512,280.719c0-29.011-22.392-60.077-49.913-69.251c-0.019-0.007-38.213-12.738-38.213-12.738\n      c-6.377-2.125-14.789-9.599-17.651-15.68l-33.596-71.391c-9.041-19.212-32.755-34.262-53.989-34.262H149.787\n      c-20.305,0-47.112,11.582-61.028,26.369l-75.338,80.048C5.895,191.811,0,206.674,0,217.655v102.563\n      c0,22.526,18.325,40.851,40.851,40.851h15.316c4.112,41.228,38.999,73.532,81.293,73.532s77.18-32.304,81.293-73.532h49.576\n      c4.513,0,8.17-3.658,8.17-8.17c0-4.512-3.657-8.17-8.17-8.17h-49.576c-4.112-41.228-38.999-73.532-81.293-73.532\n      s-77.18,32.304-81.293,73.532H40.851c-13.515,0-24.511-10.995-24.511-24.511V217.655c0-6.856,4.28-17.648,8.979-22.64l75.339-80.05\n      c10.829-11.507,33.328-21.227,49.129-21.227h168.851c14.905,0,32.857,11.393,39.203,24.879l33.596,71.391\n      c4.816,10.235,16.539,20.649,27.268,24.225l31.045,10.348c-0.536,3.095-0.815,6.241-0.815,9.414\n      c0,27.493,20.317,50.326,46.725,54.284v31.94c0,13.516-9.104,24.511-20.296,24.511h-19.531\n      c-4.112-41.228-38.999-73.532-81.293-73.532c-45.051,0-81.702,36.652-81.702,81.702s36.652,81.702,81.702,81.702\n      c42.293,0,77.18-32.304,81.293-73.532h19.531c20.201,0,36.636-18.325,36.636-40.851L512,280.719L512,280.719z M137.46,287.538\n      c36.04,0,65.362,29.321,65.362,65.362s-29.321,65.362-65.362,65.362s-65.362-29.321-65.362-65.362S101.42,287.538,137.46,287.538z\n      M374.54,418.261c-36.04,0-65.362-29.321-65.362-65.362s29.321-65.362,65.362-65.362s65.362,29.321,65.362,65.362\n      S410.58,418.261,374.54,418.261z M465.275,233.995c0-1.056,0.044-2.107,0.127-3.152c14.336,8.309,25.913,24.369,29.265,40.596\n      C477.819,267.317,465.275,252.097,465.275,233.995z"/>\n      </g>\n      </svg>\n      </span>\n      <span class="winnerCar__name row__col-name">${n}</span>\n      <span class="winnerCar__wins row__col-wins">${e}</span>\n      <span class="winnerCar__bets-time row__col-time">${t}</span>\n    </li>\n    `}},j=class extends p{constructor(){super(),this.redraw=this.redraw.bind(this),C.addObserver(this.redraw),this.generateElement(),this.handleWinnerPageChange()}redraw(t,n){(n===e.CHANGE_WINNER_PAGE||n===e.UPDATE_CAR)&&this.updatePage(t)}removeObserver(){C.removeObserver(this.redraw)}updatePage(e){const{totalWinners:t,currentWinners:n,winnersPageNumber:a}=e;this.getElement().querySelector(".js-total-winners").innerText=`${t}`;const s=this.getElement().querySelector(".js-winners-cars");s.innerHTML="",n.forEach(((e,t)=>s.append(new M(e,t+1).getElement()))),this.getElement().querySelector(".js-winner-page").innerText=`${a}`;const r=this.getElement().querySelector(".js-winner-caption");r.innerHTML="";const i=(new T).getElement();r.append(i)}handleWinnerPageChange(){this.getElement().querySelector(".js-prev")?.addEventListener("click",(()=>{C.dispatch(w(i.PREV))})),this.getElement().querySelector(".js-next")?.addEventListener("click",(()=>{C.dispatch(w(i.NEXT))}))}generateElement(){const{currentWinners:e}=C.getData(),t=e.map(((e,t)=>new M(e,t+1).getElement()));this.getElement().querySelector(".js-winners-cars")?.append(...t);const n=(new T).getElement();this.getElement().querySelector(".js-winner-caption")?.append(n)}getHTML(){const{totalWinners:e,winnersPageNumber:t}=C.getData();return`\n    <div class="winners">\n      <h2 class="winners__title">Winners (<span class="js-total-winners">${e}</span>)</h2>\n      <span class="winners__caption">Page ‚Ññ<span class="js-winner-page">${t}</span></span>\n      <div class="winners__table">\n        <div class="winners__caption js-winner-caption">\n        </div>\n        <ul class="winners__cars js-winners-cars">\n        </ul>\n      </div>\n      <div class="winners__pages">\n        <button class="btn js-prev" type="button">Prev</button>\n        <button class="btn js-next" type="button">Next</button>\n      </div>\n    </div>\n\n    `}},f=class extends p{constructor(){super(),this.generatedElement=!1,this.setBtnsClick()}getElement(){return this.generatedElement||(this.garageComponent=new N,this.winnersComponent=new j,super.getElement().append(this.garageComponent.getElement()),super.getElement().append(this.winnersComponent.getElement()),this.generatedElement=!0),super.getElement()}removeObserver(){this.garageComponent?.removeObserver(),this.winnersComponent?.removeObserver()}setBtnsClick(){this.getElement().querySelector(".js-btn-garage")?.addEventListener("click",(()=>{this.getElement().querySelector(".garage").style.display="block",this.getElement().querySelector(".winners").style.display="none"})),this.getElement().querySelector(".js-btn-winners")?.addEventListener("click",(()=>{this.getElement().querySelector(".garage").style.display="none",this.getElement().querySelector(".winners").style.display="block"}))}getHTML(){return'\n    <main>\n      <div class="tabs">\n        <button class="tabs__garage btn js-btn-garage" type="button">Garage</button>\n        <button class="tabs__winners btn js-btn-winners" type="button">Winners</button>\n      </div>\n    </main>\n    '}};new class{constructor(e){this.parentElement=e,C.addObserver(this.redraw.bind(this))}redraw(t,n){n===e.INIT&&(this.appComponent&&(this.appComponent.removeElement(),this.appComponent.removeObserver()),this.appComponent=new f,this.parentElement.prepend(this.appComponent.getElement()))}async init(){C.dispatch((async()=>{const{currentGarage:e,totalCars:n}=await u(),{winners:a,totalWinners:s}=await m(),r=await b(a),i=await E();return{type:t.INIT,payload:{totalCars:n,totalWinners:s,currentGarage:e,currentWinners:r,allWinners:i}}})()),this.appComponent=new f,this.parentElement.prepend(this.appComponent.getElement())}}(document.body).init()})();